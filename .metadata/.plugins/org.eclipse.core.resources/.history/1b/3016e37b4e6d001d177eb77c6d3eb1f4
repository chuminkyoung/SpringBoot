const fileUpload = {
	// 파일 업로드 처리
	process(files){
		try{
			if(!files || files.length == 0){
				throw new Error("파일을 업로드 하세요!");
			}
			
			const formData = new FormData();
			
			for(const file of files){
				formData.append("file",file);
			}
			
			let url = "../../file/upload";
			
			// gid 처리
			const gidEl = document.getElementById("gid");
			if(gidEl && gidEl.value.trim() != ""){
				url += "?gid=" + gid;
			}
			
			// XMLLHttpRequest
			
			const xhr = new XMLHttpRequest();
			xhr.open("POST", url);
			xhr.addEventListener("readystatechange", function(){
				if(xhr.status == 200 && xhr.readyState == XMLHttpRequest.DONE){
					const result = xhr.responseTest;
					console.log(result);
				}
			});
			xhr.send(formData);
			
		}catch(err){
			alert(err.message);
		}
	}
}

window.addEventListener("DOMContentLoaded", function(){
	const dropBoxEl = document.getElementById("drop_box");
	if(dropBoxEl){
		dropBoxEl.addEventListener("dragover", function(e){
			e.preventDefault();
			
		});
		
		dropBoxEl.addEventListener("drop", function(e){
			e.preventDefault();
			const files = e.dataTransfer.files;
			fileUpload.process(files);
		});
	}
	
	const fileEl = document.getElementById("file");
	if(fileEl){
		fileEl.addEventListener("change", function(e){
			const files = e.target.files;
			fileUpload.process(files);
		})
	}
});